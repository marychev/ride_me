#:import Window kivy.core.window.Window
#:import Scene layout.scene.Scene
#:import Tools layout.tools.Tools
#:import LeftButtonWidget button.left_button.LeftButtonWidget
#:import RightButtonWidget button.right_button.RightButtonWidget
#:import Road road.road.Road
#:import Bike bike.bike.Bike
#:import Curtain label.curtain.Curtain
#:import FS utils.sizes.FontSize
#:import BASE_WIDTH_BTN utils.sizes.BASE_WIDTH_BTN
#:import BIKE_WIDTH utils.sizes.BIKE_WIDTH
#:import BIKE_HEIGHT utils.sizes.BIKE_HEIGHT
#:import ROAD_BIKE_LINE_Y utils.sizes.ROAD_BIKE_LINE_Y
#:import BIKE_POS_X utils.sizes.BIKE_POS_X
#:import WH utils.sizes.WH
#:import Currency objects.currency.currency.Currency

# ! #:import DevTools devtools.devtools.DevTools

#:import time time


<ToolsLabel@Label>:
    font_size: FS.NORMAL.value
    markup: True


<GameScreen>:
    Scene:
        id: scene

        Background:
            id: background
            texture: root.ids.road.level and root.ids.road.level.background_texture_default

        Road:
            id: road
            pos: 0, root.ids.tools.height
            size: Window.width, BASE_WIDTH_BTN
            size_hint: None, None

            # road line points
            canvas:
                Color:
                    rgb: 0, 0, 0
                Line:
                    bezier: self.line_points
                    width: 1.

        Bike:
            id: bike
            pos: BIKE_POS_X, ROAD_BIKE_LINE_Y
            width: self.texture_size[0] + (BIKE_WIDTH - self.texture_size[0])
            height: self.texture_size[1] + (BIKE_HEIGHT - self.texture_size[1])
            size_hint: None, None

        Curtain:
            id: curtain
            scene: root.ids.scene
            road: root.ids.road

    Tools:
        id: tools
        size_hint: 1, None
        height: BASE_WIDTH_BTN
        width: Window.width

        canvas.before:
            Color:
                rgba: 0, 0, 0, .8
            Rectangle:
                pos: self.pos
                size: self.size

        AnchorLayout:
            id: left_btn_wrap
            anchor_x: 'left'
            anchor_y: 'bottom'
            LeftButtonWidget:
                Label:
                    markup: True
                    pos: self.parent.pos
                    text: "[b]      stop:[/b]\n [size=11]{}[/size]".format(root.ids.road.state)

        AnchorLayout:
            anchor_x: 'center'
            anchor_y: 'bottom'
            BoxLayout:
                ToolsLabel:
                    text: root.ids.tools.indicator_power(root.ids.bike.power)
                ToolsLabel:
                    text: "[sup]Acceleration[/sup]{:3.2f}".format(root.ids.bike.acceleration)
                ToolsLabel:
                    text: root.ids.tools.indicator_speed(root.ids.bike.speed)

        AnchorLayout:
            id: right_btn_wrap
            anchor_x: 'right'
            anchor_y: 'bottom'
            RightButtonWidget:
                Label:
                    pos: self.parent.pos
                    text: 'go'

    RelativeLayout:
        id: currency_game_wrap
        size_hint: None, None
        pos: 0, Window.height-75
        Label:
            font_size: FS.SMALL.value
            markup: True
            text: "{} {}".format(root.ids.bike.collected_currency, Currency.units)

    RelativeLayout:
        id: menu_game_wrap
        size_hint: None, None
        height: sp(36)
        width: sp(36)
        pos: Window.width-self.height, Window.height-self.height
        Button:
            background_color: 0, 0, 0, .2
            text: '''MENU'''
            markup: True
            font_size: FS.SMALL.value
            size_hint: None, None
            width: self.parent.width
            height: self.parent.height
            on_press: root.manager.current = 'start'

        ## activate devtools
        #FloatLayout:
        #    DevTools:
        #        id: devtools
        #        scene: root.ids.scene
        #        road: root.ids.road
